{% extends "base.html" %}
{% block title %}View Posts{% endblock %}
{% block content %}

{% for post in posts %}
    <div class="post">
        <h2>
            <a href="/blog/{{post.permalink}}">
            {{ post.subject }}
            </a>
        </h2>

        <em>
        {% for user in users %}
            {# post.key.parent().id() = id of parent of this post (user id) #}
            {# user.key.id() = id of user, going through a list of all users. not very efficient. #}

            {% if post.key.parent().id() == user.key.id() %}
                Posted by {{ user.username }}
            {% endif %}

        {% endfor %}

        on {{ post.postcreated.strftime("%A, %B %d, %Y @ %H:%I") }}
        </em>

        {# link to like a post #}

        {# if userid AND logged in userid does NOT equal post.parent.id, allow to like #}
        {% if userid|int() and userid|int() != post.key.parent().id()|int() %}

            {% if userid in post.likes %}
                {# logged in user has liked this post #}
                <a href="/blog/{{post.permalink}}/unlike"><span class="glyphicon glyphicon-star"></span></a>
            {% endif %}

            {% if userid not in post.likes %}
                {# logged in user has NOT liked this post #}
                <a href="/blog/{{post.permalink}}/like"><span class="glyphicon glyphicon-star-empty"></span></a>
            {% endif %}

        {% endif %}

        {# if NOT userid (not logged in) OR logged in userid DOES equal post.parent.id, do NOT allow to like #}
        {% if not userid or userid|int() == post.key.parent().id()|int() %}

            {# if the post has at least one like, show star, otherwise, show star-empty #}
            {% if post.likes %}
                <span class="glyphicon glyphicon-star"></span>
            {% endif %}
            {% if not post.likes %}
                <span class="glyphicon glyphicon-star-empty"></span>
            {% endif %}
        {% endif %}

        <br><br>

        {{ post.render() | safe }}
    </div>


{% endfor %}

{% endblock %}

{% extends "base.html" %}
{% block title %}
    {{ post.subject }} - Permalink
{% endblock %}
{% block content %}

<h2>
    <a href="/blog/{{post.permalink}}">
    {{ post.subject }}
    </a>
</h2>

<em>
Posted by {{ post.get_owner(post.key.parent().id()) }}

on {{ post.postcreated.strftime("%A, %B %d, %Y @ %H:%I") }}
</em>

{% if owner %}
    <a class="btn btn-primary" href="/blog/{{post.permalink}}/edit">edit post</a>
    <a class="btn btn-danger" href="/blog/{{post.permalink}}/delete">delete post</a>
{% endif %}

{# link to like a post #}

    {# if userid AND logged in userid does NOT equal post.parent.id, allow to like #}
    {% if userid|int() and userid|int() != post.key.parent().id()|int() %}

        {% if userid in post.likes %}
            {# logged in user has liked this post #}
            <a href="/blog/{{post.permalink}}/like"><span class="glyphicon glyphicon-star"></span></a>
        {% endif %}

        {% if userid not in post.likes %}
            {# logged in user has NOT liked this post #}
            <a href="/blog/{{post.permalink}}/like"><span class="glyphicon glyphicon-star-empty"></span></a>
        {% endif %}

    {% endif %}

    {# if NOT userid (not logged in) OR logged in userid DOES equal post.parent.id, do NOT allow to like #}
    {% if not userid or userid|int() == post.key.parent().id()|int() %}

        {# if the post has at least one like, show star, otherwise, show star-empty #}
        {% if post.likes %}
            <span class="glyphicon glyphicon-star"></span>
        {% endif %}
        {% if not post.likes %}
            <span class="glyphicon glyphicon-star-empty"></span>
        {% endif %}
    {% endif %}

{#  END link to like a post #}


<br><br>

{{ post.render() | safe }}

<br><br>

{% if username %} {# user is logged in #}
    <form method="post">
        Comments?<br>
        <textarea name="comment"></textarea>
        <input type="submit" value="add comment!">
    </form>
{% endif %}

{% for comment in comments %}
    Comment by {{ comment.username }}
    on {{ comment.commentcreated.strftime("%A, %B %d, %Y @ %H:%I") }}:
    <br>
    {{ comment.content }}
    <hr>
{% endfor %}

{% endblock %}
